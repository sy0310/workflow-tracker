# 部门项目表设置指南

## 问题说明

如果您遇到以下错误之一：
- "加载任务列表失败" 的错误
- "PUT /api/departments/{department}/projects/{id} 500 (Internal Server Error)" 错误

这是因为数据库中缺少四个部门的项目表，或者部门表缺少必要的列。

## 解决方案

### 情况 1：首次创建部门表

如果您还没有创建部门表，请按照以下步骤操作：

#### 方法 1：使用 Supabase Dashboard（推荐）

1. **登录 Supabase**
   - 访问 [https://supabase.com/dashboard](https://supabase.com/dashboard)
   - 登录您的账户

2. **打开 SQL Editor**
   - 选择您的项目
   - 在左侧菜单中点击 "SQL Editor"
   - 点击 "New query"

3. **执行 SQL**
   - 复制 `scripts/create-department-tables.sql` 文件的全部内容
   - 粘贴到 SQL Editor 中
   - 点击 "Run" 执行

4. **验证创建成功**
   - 在左侧菜单点击 "Table Editor"
   - 确认以下四个表已创建：
     - 产业分析
     - 创意实践
     - 活动策划
     - 资源拓展

#### 方法 2：使用 PostgreSQL 客户端

如果您使用的是本地 PostgreSQL 数据库：

```bash
# 使用 psql 命令行工具
psql -U your_username -d your_database -f scripts/create-department-tables.sql
```

### 情况 2：已存在部门表但缺少 "更新时间" 列

如果您已经创建了部门表，但遇到 "500 Internal Server Error" 错误，可能是因为缺少 "更新时间" 列。

#### 解决步骤：

1. **在 Supabase SQL Editor 中执行**：
   - 复制 `scripts/add-updated-at-column.sql` 文件的全部内容
   - 粘贴到 SQL Editor 中
   - 点击 "Run" 执行

2. **或使用命令行**：
   ```bash
   psql -U your_username -d your_database -f scripts/add-updated-at-column.sql
   ```

执行完成后，项目更新功能应该可以正常工作。

## 表结构说明

每个部门表都包含以下字段：

### 公共字段
- `id` - 主键
- `项目名称` - 项目标题
- `项目描述` - 项目详细描述
- `负责人` - 项目负责人姓名
- `优先级` - 1:低, 2:中, 3:高, 4:紧急
- `状态` - 1:待开始, 2:进行中, 3:已完成, 4:已取消
- `开始时间` - 项目开始时间
- `预计完成时间` - 预计完成时间
- `实际完成时间` - 实际完成时间
- `创建时间` - 记录创建时间
- `更新时间` - 记录最后更新时间
- `创建者` - 创建者ID

### 产业分析部门特有字段
- 分析类型
- 目标行业
- 分析范围
- 数据来源
- 分析方法
- 关键发现
- 建议措施
- 风险因素

### 创意实践部门特有字段
- 创意类型
- 目标用户
- 创意概念
- 实施计划
- 资源需求
- 预期效果
- 创新点
- 可行性分析

### 活动策划部门特有字段
- 活动类型
- 目标受众
- 活动规模
- 预算范围
- 活动地点
- 活动时间
- 活动流程
- 宣传策略
- 物料需求
- 人员配置

### 资源拓展部门特有字段
- 资源类型
- 目标对象
- 拓展方式
- 资源价值
- 获取难度
- 预期收益
- 风险评估
- 拓展计划
- 关键联系人
- 跟进策略

## 示例数据

SQL 文件中包含了每个部门的示例项目数据，帮助您快速了解系统功能。

## 验证设置

执行 SQL 后，刷新应用页面，您应该能够：
1. 在"任务管理"页面看到四个部门的项目
2. 在"部门管理"页面点击各部门查看项目
3. 创建新项目时选择部门和填写部门特定字段

## 常见问题

**Q: 执行 SQL 时出现权限错误？**
A: 确保您的数据库用户有创建表的权限。在 Supabase 中，使用管理员账户登录。

**Q: 表名包含中文，会有问题吗？**
A: PostgreSQL 完全支持 UTF-8 编码的表名，不会有问题。我们使用双引号包裹表名以确保兼容性。

**Q: 我想自定义部门或字段怎么办？**
A: 修改 `scripts/create-department-tables.sql` 文件，添加或删除字段，然后重新执行。

## 需要帮助？

如果遇到问题，请检查：
1. 数据库连接是否正常
2. 环境变量 `DATABASE_URL` 或 Supabase 配置是否正确
3. 浏览器控制台的详细错误信息

